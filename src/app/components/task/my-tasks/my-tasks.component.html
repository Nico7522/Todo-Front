<main class="box-shadow">
  <h2 class="primary white mat-headline-6">Your tasks</h2>
  <div class="wrapper">
    <app-tasks-filter
      (onSearchUpdatedEmmiter)="onSearchUpdated($event)"
      (onPriorityUpdatedEmmiter)="onPriorityUpdated($event)"
      (onTaskDoneChangeEmmiter)="onTaskDoneChange($event)"
    />
    @if(task$ | async) {
    <div class="table">
      <table
        mat-table
        [dataSource]="filteredTasks()"
        M
        class="mat-elevation-z8"
      >
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Title</th>
          <td mat-cell *matCellDef="let task">{{ task.title }}</td>
        </ng-container>

        <ng-container matColumnDef="priority">
          <th mat-header-cell *matHeaderCellDef>Priority</th>
          <td mat-cell *matCellDef="let task">
            {{ task.priority | priority }}
          </td>
        </ng-container>

        <ng-container matColumnDef="details">
          <th mat-header-cell *matHeaderCellDef>Details</th>
          <td mat-cell *matCellDef="let task">
            <button
              (click)="openTaskDetailsDialog(task.id)"
              mat-mini-fab
              color="primary"
            >
              <mat-icon>visibility</mat-icon>
            </button>
          </td>
        </ng-container>

        <ng-container matColumnDef="advancement">
          <th mat-header-cell *matHeaderCellDef>Advancement</th>
          <td mat-cell *matCellDef="let task">
            <mat-icon
              [ngClass]="task.isComplete ? 'task-done' : 'task-undone'"
              >{{ task.isComplete ? "check_circle" : "pending" }}</mat-icon
            >
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayedColumns.length">
            No data matching the filter.
          </td>
        </tr>
      </table>
    </div>

    } @else {
    <table mat-table [dataSource]="[]">
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Title</th>
      </ng-container>

      <ng-container matColumnDef="priority">
        <th mat-header-cell *matHeaderCellDef>Priority</th>
      </ng-container>

      <ng-container matColumnDef="details">
        <th mat-header-cell *matHeaderCellDef>Details</th>
      </ng-container>

      <ng-container matColumnDef="advancement">
        <th mat-header-cell *matHeaderCellDef>Advancement</th>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          @if (errorMessage()) {
          {{ errorMessage() }}
          }
        </td>
      </tr>
    </table>
    }
  </div>
</main>
